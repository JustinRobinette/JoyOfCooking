---
title: "Final Project"
author: "Justin Robinette"
date: "8/3/2018"
output: word_document
---
 
*I loaded the Food_Des, Weight, Nut_Dat text files.*
```{r}
Food_Des <- read.table("FOOD_DES.txt",header=FALSE,sep="^",quote="~")
names(Food_Des) <- c("NDB_No","FdGrp_Cd","Long_Desc","Shrt_Desc","ComName","ManufacName","Survey","Ref_desc","Refuse","SciName", "N_Factor","Pro_Factor","Fat_Factor","CHO_Factor")
head(Food_Des)

Weight <- read.table("WEIGHT.TXT",header=FALSE,sep="^",quote="~")
names(Weight) <- c("NDB_No","Seq","Amount","Msre_Desc","Gm_Wgt","Num_Data_Pts","Std_Dev")
head(Weight)

Nut_Data <- read.table("NUT_DATA.TXT",header=FALSE,sep="^",quote="~", stringsAsFactors = FALSE)
names(Nut_Data) <- c("NDB_No","Nutr_No","Nutr_Val","Num_Data_Pts","Std_Error",
"Src_Cd","Deriv_Cd","Ref_NDB_No","Add_Nutr_Mark","Num_Studies",
"Min","Max","DF","Low_EB","Up_EB","Stat_cmt","AddMod_Date")
head(Nut_Data)
```

*Loading recipes from RecipeTables file.*
```{r}
library(plyr)
library(dplyr)

#setwd to the path where you've saved the RecipeTables folder from Github
setwd("C:/Users/justi/Dropbox/DSU/STAT 700/Final Project/RecipeTables/")

#create a path.to.recipes using that same path from above
path.to.recipes <- "C:/Users/justi/Dropbox/DSU/STAT 700/Final Project/RecipeTables/"

#create 'recipes' as a list of files in the 'RecipeTables' folder from GitHub that you've saved to your local drive
recipes <- list.files(path.to.recipes)

#created function to read each table in RecipeTables downloaded from GitHub
read.filename <- function(recipes){
  temp <- read.table(recipes, header = TRUE, sep = "\t")
  temp$Filename <- recipes 
  temp
}

#created data frame using 'ldply' using the list of recipes to iterate through the read.filename function
recipes.dat <- ldply(recipes, read.filename)

#used coalesce function to combine some obvious columns
recipes.dat$NDB_No <- coalesce(recipes.dat$NBD_No, recipes.dat$NDB, recipes.dat$NDB_No, recipes.dat$NDB_NO)
recipes.dat$Ingredient <- coalesce(recipes.dat$Ingredient, recipes.dat$Ingredients)
recipes.dat$Measure <- coalesce(recipes.dat$Measure, coalesce(recipes.dat$Unit))

#deleting recipes that were combined tables of '36 and '06 ingredients
recipes.dat <- recipes.dat[!grepl("36_06", recipes.dat$Filename),]

nrow(recipes.dat) #1,153 rows
```

*Creating a separate table for recipes that conform to the project parameters without manipulation.*
```{r}
#created conforming.recipes table using only those recipes that do not have an 'NA' value in the Amount, Measure & Ingredient columns
conforming.recipes <- subset(recipes.dat, (!is.na(recipes.dat[,"Amount"]))&(!is.na(recipes.dat[,"Measure"]))&(!is.na(recipes.dat[,"Ingredient"])))
conforming.recipes <- conforming.recipes[,c("Filename", "Amount", "Measure", "Ingredient", "NDB_No")]

#added placeholder columns for 'Recipe' and 'Year'
conforming.recipes[,"Recipe"] <- NA
conforming.recipes[,"Year"] <- NA

#arranged columns per project format
conforming.recipes <- conforming.recipes[c("Filename","Recipe","Year","Amount","Measure","Ingredient", "NDB_No")]

#iterated through the conforming.recipes table to remove any extensions in the Filenames to allow us to fill the 'Recipe' and 'Year' columns easier
for(i in length(conforming.recipes)){
  if(!grepl("*.6$", conforming.recipes$Filename[i])){
    conforming.recipes$Filename <- sub("*.tab$|*.txt$|*.dat.tab$", "", conforming.recipes$Filename)
  } else {
    conforming.recipes$Filename <- recipes.dat$Filename
  }
}

#iterate through conforming.recipes to use alpha values for 'Recipe' and numeric values for 'Year'
for (i in conforming.recipes){
  conforming.recipes$Recipe <- gsub("[^[:alpha:]]","",conforming.recipes$Filename)
  conforming.recipes$Year <- gsub("[^0-9]","",conforming.recipes$Filename)
}

#drop filename
conforming.recipes$Filename <- NULL

#fix a couple of incorrect year values due to improper naming of midterm files
conforming.recipes$Year[conforming.recipes$Year =="36"] <- "1936"
conforming.recipes$Year[conforming.recipes$Year =="06"] <- "2006"

#noticed some Measure values were in capitalized letters and all Msre_Desc from 'Weight' are in lower case. 
#Also noticed many recipes submitted used 'Tbs' for tablespoon whereas the 'Weight' table uses 'tbsp' so I made that change.
conforming.recipes$Measure <- tolower(conforming.recipes$Measure)
conforming.recipes$Measure[conforming.recipes$Measure=='tbs'] <- 'tbsp'

nrow(conforming.recipes) #575 rows
```

*Creating a separate table of the recipes that don't conform without manipulation, called 'nonconforming.recipes'.*
```{r}
#create a subset of recipes that do have an NA value in either the Amount, Measure or Ingredient columns
nonconforming.recipes <- subset(recipes.dat, (is.na(recipes.dat[,"Amount"]))|(is.na(recipes.dat[,"Measure"]))|(is.na(recipes.dat[,"Ingredient"])))

#filter out the nonconforming.recipes table to drop any columns that are all NA
nonconforming.recipes <- Filter(function(x)!all(is.na(x)),nonconforming.recipes)

#create a list of the recipes that were not submitted in the project format by iterating through the nonconforming.recipes table
nonconforming.list <- NULL
for (i in nonconforming.recipes) {
  nonconforming.list <- nonconforming.recipes$Filename
}

#removing the duplicates from the list of nonconforming recipes
nonconforming.list <- nonconforming.list[!duplicated(nonconforming.list)]

nrow(nonconforming.recipes) #578 rows + 575 rows of conforming.recipes = 1,153 from recipes.dat
```

*Manipulating the nonconforming recipes to get them in a format that can be merged with the conforming recipes.*
```{r}
library(dplyr)
#iterate through nonconforming.list to create separate table for recipes that used 'sep=""'
setwd('C:/Users/justi/Dropbox/DSU/STAT 700/Final Project/RecipeTables/')

#created function to read each table that is nonconforming from the RecipeTables downloaded from GitHub
read.nonconforming <- function(nonconforming.list) {
  temp.nc <- read.table(nonconforming.list, header=TRUE, sep="")
  temp.nc$Filename <- nonconforming.list
  temp.nc
}

#created data frame using 'ldply' using the list of nonconforming to iterate through the read.nonconforming function
nonconform.dat <- ldply(nonconforming.list, read.nonconforming)

#deleting columns that contain all NA values
nonconform.dat <- Filter(function(x)!all(is.na(x)),nonconform.dat)

#used coalesce function to combine some obvious columns - not all combined so we might want to dig deeper into this
nonconform.dat$NDB_No <- coalesce(nonconform.dat$NDB_No, nonconform.dat$ndb, nonconform.dat$NBD_No, nonconform.dat$NDB, nonconform.dat$NDB_NO)
nonconform.dat$Ingredient <- coalesce(nonconform.dat$Ingredient, nonconform.dat$Ingredients)
nonconform.dat$Measure <- coalesce(nonconform.dat$Unit, nonconform.dat$Measure)

#set column names
nonconform.dat <- nonconform.dat[,c("Filename", "Amount", "Measure", "Ingredient", "NDB_No")]

#added placeholder columns for 'Recipe' and 'Year'
nonconform.dat[,"Recipe"] <- NA
nonconform.dat[,"Year"] <- NA

#arranged columns per project format
nonconform.dat <- nonconform.dat[c("Filename","Recipe","Year","Amount","Measure","Ingredient", "NDB_No")]

#iterated through the nonconform.dat table to remove any extensions in the Filenames to allow us to fill the 'Recipe' and 'Year' columns easier
for(i in length(nonconform.dat)){
  if(!grepl("*.6$", nonconform.dat$Filename[i])){
    nonconform.dat$Filename <- sub("*.tab$|*.txt$|*.dat.tab$", "", nonconform.dat$Filename)
  } else {
    nonconform.dat$Filename <- recipes.dat$Filename
  }
}

#iterate through nonconform.dat to use alpha values for 'Recipe' and numeric values for 'Year'
for (i in nonconform.dat){
  nonconform.dat$Recipe <- gsub("[^[:alpha:]]","",nonconform.dat$Filename)
  nonconform.dat$Year <- gsub("[^0-9]","",nonconform.dat$Filename)
}

#drop filename
nonconform.dat$Filename <- NULL

#fix a couple of incorrect year values due to improper naming of midterm files
nonconform.dat$Year[nonconform.dat$Year =="36"] <- "1936"
nonconform.dat$Year[nonconform.dat$Year =="06"] <- "2006"

#noticed some Measure values were in capitalized letters and all Msre_Desc from 'Weight' are in lower case
#noticed many recipes submitted used 'Tbs' for tablespoon whereas the 'Weight' table uses 'tbsp' so I made that change
#noticed someone used 'irg' instead of 'lrg' for eggs in AsparagusTimbales
nonconform.dat$Measure <- tolower(nonconform.dat$Measure)
nonconform.dat$Measure[nonconform.dat$Measure=='tbs'] <- 'tbsp'
nonconform.dat$Measure[nonconform.dat$Measure=='irg'] <- 'lrg'

# Fix meatloaf recipes to meet project naming requirements
for (i in 1:nrow(nonconform.dat)) {
  if (nonconform.dat$Year[i]==11936) {
    nonconform.dat$Year[i] <- 1936
    nonconform.dat$Recipe[i] <- paste(nonconform.dat$Recipe[i], "1", sep = "")
  }
  if (nonconform.dat$Year[i]==12006) {
    nonconform.dat$Year[i] <- 2006
    nonconform.dat$Recipe[i] <- paste(nonconform.dat$Recipe[i], "1", sep = "")
  }
  if (nonconform.dat$Year[i]==21936) {
    nonconform.dat$Year[i] <- 1936
    nonconform.dat$Recipe[i] <- paste(nonconform.dat$Recipe[i], "2", sep = "")
  }
  if (nonconform.dat$Year[i]==22006) {
    nonconform.dat$Year[i] <- 2006
    nonconform.dat$Recipe[i] <- paste(nonconform.dat$Recipe[i], "2", sep = "")
  }
}

nrow(nonconform.dat) #620 rows + 575 conforming rows = 1,195 from inital 'merged.dat' below
```

*Merging the conforming and nonconforming recipes.*
```{r}
#combined the conforming and nonconforming recipes together
merged.dat <- rbind(conforming.recipes, nonconform.dat)

#sorting data by Recipe and then by Year
merged.dat <- merged.dat[with(merged.dat, order(merged.dat$Recipe, merged.dat$Year)),]

nrow(merged.dat) #1,195 rows


#deleting recipes where one or more 'Measure' values are missing
library(dplyr)

merged.dat <-
  merged.dat %>%
  group_by(Recipe,Year) %>%
  filter(!any(is.na(Measure)))

nrow(merged.dat) #1,040 rows after 'Measure' NAs removed

# for some reasons the ingredient column is integer. We want to convert it to character
merged.dat$Ingredient <- as.character(merged.dat$Ingredient)
```

*Updating NA value ingredients.*
```{r}
# There are few ingredients that are NA in the merged data set
# But because we have NDB_No for them I am going to update them from food dataset 
# Below I am joining merged.dat to food data set using NDB_No
M <- merge(merged.dat[is.na(merged.dat$Ingredient),],Food_Des, by = "NDB_No")

ndb <- M$NDB_No
ingr <- M$Long_Desc

m.lookup <- data.frame(ndb, ingr)
m.lookup <- unique(m.lookup)

nrow(merged.dat) #1,040 rows
```

*Fixing missing data.*
```{r}
# Fixing missing values for NDB_No and ingredients
merged.dat$Ingredient[merged.dat$NDB_No==1001] <- "Butter, salted"
merged.dat$Ingredient[merged.dat$NDB_No==1009] <- "Cheese, cheddar (Includes foods for USDA's Food Distribution Program)"
merged.dat$Ingredient[merged.dat$NDB_No==1077] <- "Milk, whole, 3.25% milkfat, with added vitamin D"
merged.dat$Ingredient[merged.dat$NDB_No==2050] <- "Vanilla extract"
merged.dat$Ingredient[merged.dat$NDB_No==6043] <- "Soup, cream of mushroom, canned, condensed"
merged.dat$Ingredient[merged.dat$NDB_No==6971] <- "Sauce, worcestershire"
merged.dat$Ingredient[merged.dat$NDB_No==7029] <- "Butter, salted"
merged.dat$Ingredient[merged.dat$NDB_No==11354] <- "Ham, sliced, regular (approximately 11% fat)"
merged.dat$Ingredient[merged.dat$NDB_No==11371] <- "Potatoes, mashed, home-prepared, whole milk and margarine added"
merged.dat$Ingredient[merged.dat$NDB_No==11943] <- "Pimento, canned"
merged.dat$Ingredient[merged.dat$NDB_No==14003] <- "Alcoholic beverage, beer, regular, all"
merged.dat$Ingredient[merged.dat$NDB_No==19335] <- "Sugars, granulated"
merged.dat$Ingredient[merged.dat$NDB_No==20046] <- "Rice, white, long-grain, parboiled, enriched, dry"
merged.dat$NDB_No[merged.dat$Ingredient=="apples, raw, without skin"] <- 9004
merged.dat$NDB_No[merged.dat$Ingredient=="asparagus, raw"] <- 11011
merged.dat$NDB_No[merged.dat$Ingredient=="bamboo shoots, canned, drained solids"] <- 11028
merged.dat$NDB_No[merged.dat$Ingredient=="beef, round, tip round, roast, separable lean only, trimmed to 0\" fat, all grades, raw"] <- 23651
merged.dat$NDB_No[merged.dat$Ingredient=="beef, variety meats and by-products, suet, raw"] <- 13335
merged.dat$NDB_No[merged.dat$Ingredient=="beets, pickled, canned, solids and liquids"] <- 11609
merged.dat$NDB_No[merged.dat$Ingredient=="bread, crumbs, dry, grated, plain"] <- 18079
merged.dat$NDB_No[merged.dat$Ingredient=="butter, salted"] <- 1001
merged.dat$NDB_No[merged.dat$Ingredient=="candied fruit"] <- 9426
merged.dat$NDB_No[merged.dat$Ingredient=="capers, canned"] <- 2054
merged.dat$NDB_No[merged.dat$Ingredient=="catsup"] <- 11935
merged.dat$NDB_No[merged.dat$Ingredient=="celery, raw"] <- 11143
merged.dat$NDB_No[merged.dat$Ingredient=="cheese, parmesan, grated"] <- 1032
merged.dat$NDB_No[merged.dat$Ingredient=="cornstarch"] <- 20027
merged.dat$NDB_No[merged.dat$Ingredient=="cream, fluid, heavy whipping"] <- 1053
merged.dat$NDB_No[merged.dat$Ingredient=="crustaceans, crab, blue, canned"] <- 15141
merged.dat$NDB_No[merged.dat$Ingredient=="currants, zante, dried"] <- 9085
merged.dat$NDB_No[merged.dat$Ingredient=="egg, whole, raw, fresh"] <- 1123
merged.dat$NDB_No[merged.dat$Ingredient=="fish, herring, atlantic, raw"] <- 15039
merged.dat$NDB_No[merged.dat$Ingredient=="garlic, raw"] <- 11215
merged.dat$NDB_No[merged.dat$Ingredient=="horseradish, prepared"] <- 2055
merged.dat$NDB_No[merged.dat$Ingredient=="lemon juice, raw"] <- 9152
merged.dat$NDB_No[merged.dat$Ingredient=="milk, whole, 3.25% milkfat, with added vitamin d"] <- 1077
merged.dat$NDB_No[merged.dat$Ingredient=="milk, whole, 3.25% milkfat, without added vitamin a and vitamin d"] <- 1211
merged.dat$NDB_No[merged.dat$Ingredient=="mushrooms, white, raw"] <- 11260
merged.dat$NDB_No[merged.dat$Ingredient=="mustard, prepared, yellow"] <- 2046
merged.dat$NDB_No[merged.dat$Ingredient=="nuts, almonds"] <- 12061
merged.dat$NDB_No[merged.dat$Ingredient=="oil, canola"] <- 4582
merged.dat$NDB_No[merged.dat$Ingredient=="oil, olive, salad or cooking"] <- 4053
merged.dat$NDB_No[merged.dat$Ingredient=="onions, raw"] <- 11282
merged.dat$NDB_No[merged.dat$Ingredient=="onions, yellow, sauteed"] <- 11286
merged.dat$NDB_No[merged.dat$Ingredient=="onions, young green, tops only"] <- 11292
merged.dat$NDB_No[merged.dat$Ingredient=="peaches, frozen, sliced, sweetened"] <- 9250
merged.dat$NDB_No[merged.dat$Ingredient=="peppers, sweet, green, raw"] <- 11333
merged.dat$NDB_No[merged.dat$Ingredient=="pickles, cucumber, dill or kosher dill"] <- 11937
merged.dat$NDB_No[merged.dat$Ingredient=="puddings, tapioca, dry mix"] <- 19198
merged.dat$NDB_No[merged.dat$Ingredient=="rice, white, long-grain, parboiled, unenriched, cooked"] <- 20447
merged.dat$NDB_No[merged.dat$Ingredient=="salad dressing, mayonnaise, regular"] <- 4025
merged.dat$NDB_No[merged.dat$Ingredient=="soup, cream of mushroom, canned, condensed"] <- 6043
merged.dat$NDB_No[merged.dat$Ingredient=="soup, stock, beef, home-prepared"] <- 6170
merged.dat$NDB_No[merged.dat$Ingredient=="soy sauce made from soy and wheat (shoyu)"] <- 16123
merged.dat$NDB_No[merged.dat$Ingredient=="sugars, granulated"] <- 19335
merged.dat$NDB_No[merged.dat$Ingredient=="sweet potato, cooked, boiled, without skin"] <- 11510
merged.dat$NDB_No[merged.dat$Ingredient=="vanilla extract"] <- 2050
merged.dat$NDB_No[merged.dat$Ingredient=="veal, ground, raw"] <- 17142
merged.dat$NDB_No[merged.dat$Ingredient=="veal, sirloin, separable lean and fat, cooked, braised"] <- 17135
merged.dat$NDB_No[merged.dat$Ingredient=="vinegar, cider"] <- 2048
merged.dat$NDB_No[merged.dat$Ingredient=="vinegar, red wine"] <- 2068
merged.dat$NDB_No[merged.dat$Ingredient=="wheat flour, white, all-purpose, self-rising, enriched"] <- 20082
merged.dat$NDB_No[merged.dat$Ingredient=="wheat flour, white, cake, enriched"] <- 20084
```

*Fixing missing data.*
```{r}
# Looking closely we found that the ingredients were not correct as per food data set
# We are correcting the typos, etc in the 'Ingredients' column in the below statements 
# For this we are using grep to find the closest description for the ingredient 

merged.dat$NDB_No[merged.dat$NDB_No==105053] <- 1053
merged.dat$Ingredient[merged.dat$Ingredient=="mayonnaise, regular"] <- "mayonnaise dressing, no cholesterol"
merged.dat$Ingredient[merged.dat$Ingredient=="milk, whole, 2.5%"] <- "milk, evaporated, 2% fat, with added vitamin a and vitamin d"
merged.dat$Ingredient[merged.dat$Ingredient=="milk, whole, 3.25%"] <- "milk, whole, 3.25% milkfat, without added vitamin a and vitamin d"
merged.dat$Ingredient[merged.dat$Ingredient=="milk, whole, 3.25%%"] <- "milk, whole, 3.25% milkfat, without added vitamin a and vitamin d"
merged.dat$Ingredient[merged.dat$Ingredient=="milk, whole,3.25%"] <- "milk, whole, 3.25% milkfat, without added vitamin a and vitamin d"
merged.dat$Ingredient[merged.dat$Ingredient=="milk,whole,3.25%"] <- "milk, whole, 3.25% milkfat, without added vitamin a and vitamin d"
merged.dat$Ingredient[merged.dat$Ingredient=="mushrooms, cooked, drained"] <- "mushrooms, canned, drained solids"
merged.dat$Ingredient[merged.dat$Ingredient=="mushrooms, fresh"] <- "mushrooms, white, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="mushrooms, fresh, sliced"] <- "mushrooms, white, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="mushrooms, portabella, fresh, chopped"] <- "mushrooms, white, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="mushrooms,canned, sliced, drained"] <- "mushrooms, canned, drained solids"
merged.dat$Ingredient[merged.dat$Ingredient=="mushrooms,fresh"] <- "mushrooms, white, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="oil ,canola"] <- "oil, canola"
merged.dat$Ingredient[merged.dat$Ingredient=="oil, olive"] <- "oil, olive, salad or cooking"
merged.dat$Ingredient[merged.dat$Ingredient=="oil,olive"] <- "oil, olive, salad or cooking"
merged.dat$Ingredient[merged.dat$Ingredient=="okra, cooked, drained, sliced"] <- "okra, cooked, boiled, drained, with salt"
merged.dat$Ingredient[merged.dat$Ingredient=="onion, french dried, dry"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="onion, yellow, fresh, chopped"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="onion, yellow, fresh, medium, 2 1/2"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="onion, yellow, fresh, medium, 2 1/2 inch"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="onion, yellow, fresh, sliced"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="onion, yellow, fresh,chopped"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="onion,yellow,fresh,chopped"] <- "onions, yellow, sauteed"
merged.dat$Ingredient[merged.dat$Ingredient=="oysters, eastern, in liquid, 12 oz can"] <- "soup, oyster stew, canned, prepared with equal volume wate"
merged.dat$Ingredient[merged.dat$Ingredient=="pecans, halves"] <- "pie, pecan, prepared from recipe"
merged.dat$Ingredient[merged.dat$Ingredient=="pickles, dill, chopped"] <- "pickles, cucumber, dill or kosher dill"
merged.dat$Ingredient[merged.dat$Ingredient=="pineapple,canned,crushed,in juice"] <- "pineapple, canned, water pack, solids and liquids"
merged.dat$Ingredient[merged.dat$Ingredient=="pineapple,canned,crushed,in juice,drained"] <- "pineapple, canned, water pack, solids and liquids"
merged.dat$Ingredient[merged.dat$Ingredient=="pinto beans,dry"] <- "beans, pinto, mature seeds, raw (includes foods for usda's food distribution program)"
merged.dat$Ingredient[merged.dat$Ingredient=="pork chop, center loin, raw,boneless"] <- "pork, fresh, loin, top loin (chops), boneless, separable lean and fat, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="pork ham roast, whole, roased, lean,diced"] <- "pork, cured, ham, whole, separable lean only, roasted"
merged.dat$Ingredient[merged.dat$Ingredient=="potato, cooked, peeled, diced"] <- "potatoes, white, flesh and skin, baked"
merged.dat$Ingredient[merged.dat$Ingredient=="potato, cooked, peeled, medium, 2 1/4 to 3 1/4 inch"] <- "potatoes, white, flesh and skin, baked"
merged.dat$Ingredient[merged.dat$Ingredient=="potato, white, fresh, diced"] <- "potatoes, flesh and skin, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="raisins,without seeds,packed cup"] <- "raisins, golden, seedless"
merged.dat$Ingredient[merged.dat$Ingredient=="rice, white, cooked, long grain, unenriched"] <- "rice, white, long-grain, parboiled, unenriched, cooked"
merged.dat$Ingredient[merged.dat$Ingredient=="rice, white, cooked, long grain, unriched"] <- "rice, white, long-grain, parboiled, unenriched, cooked"
merged.dat$Ingredient[merged.dat$Ingredient=="rice, white, dry, long grain, enriched"] <- "rice, white, long-grain, precooked or instant, enriched, dry"
merged.dat$Ingredient[merged.dat$Ingredient=="sausage, pork, cajun style andouille"] <- "sausage, pork, chorizo, link or ground, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="scallions, fresh, tops & bulb, chopped"] <- "onions, spring or scallions (includes tops and bulb), raw"
merged.dat$Ingredient[merged.dat$Ingredient=="shallots, fresh, chopped"] <- 'shallots, freeze-dried" "shallots, raw'
merged.dat$Ingredient[merged.dat$Ingredient=="soup,tomato,canned,condensed"] <- "soup, tomato, canned, condensed, reduced sodium"
merged.dat$Ingredient[merged.dat$Ingredient=="sour cream, cultured"] <- 'sour cream, imitation, cultured"'
merged.dat$Ingredient[merged.dat$Ingredient=="soy sauce, from soy & wheat"] <- "soy sauce made from soy and wheat (shoyu), low sodium"
merged.dat$Ingredient[merged.dat$Ingredient=="sprouts, mung bean, fresh"] <- "mung beans, mature seeds, sprouted, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="starch, corn"] <- "cornstarch"
merged.dat$Ingredient[merged.dat$Ingredient=="stock, beef, prepared from reciepe"] <- "soup, stock, beef, home-prepared"
merged.dat$Ingredient[merged.dat$Ingredient=="stock, beef, prepared from recipe"] <- "soup, stock, beef, home-prepared"
merged.dat$Ingredient[merged.dat$Ingredient=="stock, chicken, prepared from recipe"] <- "soup, stock, chicken, home-prepared"
merged.dat$Ingredient[merged.dat$Ingredient=="suet, beef, raw"] <- "beef, variety meats and by-products, suet, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="suet,beef,raw"] <- "beef, variety meats and by-products, suet, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar,  white, granulated, granulated"] <- "sugars, granulated"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar, powdered, unsifted"] <- "sugars, powdered"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar, white granulated, granulated"] <- "sugars, granulated"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar, white, granulated"] <- "sugars, granulated"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar, white, granulated, granulated"] <- "sugars, granulated"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar,brown,dark"] <- "sugars, brown"
merged.dat$Ingredient[merged.dat$Ingredient=="sugar,white,granulated,granulated"] <- "sugars, granulated"
merged.dat$Ingredient[merged.dat$Ingredient=="tapioca, quick cooking, dry"] <- "tapioca, pearl, dry"
merged.dat$Ingredient[merged.dat$Ingredient=="tofu, regular, with calcium sulfate, 1/4 block"] <- "tofu, raw, regular, prepared with calcium sulfate"
merged.dat$Ingredient[merged.dat$Ingredient=="tomatoes, fresh, year round average, chopped"] <- "tomatoes, red, ripe, raw, year round average"
merged.dat$Ingredient[merged.dat$Ingredient=="tomatos,whole,canned,with juice"] <- "tomatoes, whole, canned, with juice"
merged.dat$Ingredient[merged.dat$Ingredient=="veal, cooked"] <- "bratwurst, veal, cooked"
merged.dat$Ingredient[merged.dat$Ingredient=="vinegar"] <- "vinegar, cide"
merged.dat$Ingredient[merged.dat$Ingredient=="vinegar,red wine"] <- "vinegar, red wine"
merged.dat$Ingredient[merged.dat$Ingredient=="water, generic"] <- "water, bottled, generic "
merged.dat$Ingredient[merged.dat$Ingredient=="water,generic"] <- "water, bottled, generic "
merged.dat$Ingredient[merged.dat$Ingredient=="wheat flour,white, all-purpose,self-rising,enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="wine, red"] <- "vinegar, red wine"
merged.dat$Ingredient[merged.dat$Ingredient=="worcestershire sauce"] <- 'sauce, worcestershire"
packed in tomato juice' 
merged.dat$NDB_No[merged.dat$Ingredient=="water, bottled, generic"] <- 14555

merged.dat$Ingredient[merged.dat$Ingredient=="shallots, freeze-dried\" \"shallots, raw"] <- "shallots, freeze-dried"
merged.dat$Ingredient[merged.dat$Ingredient=="mayonnaise"] <- "salad dressing, mayonnaise, regular"
merged.dat$Ingredient[merged.dat$Ingredient=="beef,chuck,stew meat,raw,choice,urmis1100"] <- "beef, chuck for stew, separable lean and fat, choice, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="peppers, jalapeno, canned, solids and liquids\" \"peppers, jalapeno, raw"] <- "peppers, jalapeno, canned, solids and liquids"
merged.dat$Ingredient[merged.dat$Ingredient=="tomatoes, whole, canned, with juice"] <- "tomatoes, red, ripe, canned, packed in tomato juice"
merged.dat$Ingredient[merged.dat$Ingredient=="sherry, cooking"] <- "vinegar, red wine"
merged.dat$Ingredient[merged.dat$Ingredient=="egg,whole,raw,fresh"] <- "egg, whole, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="asparagus,canned,drained solids"] <- "asparagus, canned, drained solids"
merged.dat$Ingredient[merged.dat$Ingredient=="butter,salted"] <- "butter, salted"
merged.dat$Ingredient[merged.dat$Ingredient=="wheat flour,white, all-purpose,self-rising,enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="cream, fluid,heavy whipping"] <- "cream, fluid, heavy whipping"
merged.dat$Ingredient[merged.dat$Ingredient=="bread,crumbs,dry,grated, plain"] <- "bread, crumbs, dry, grated, plain"
merged.dat$Ingredient[merged.dat$Ingredient=="sour cream, imitation, cultured\""] <- "sour cream, imitation, cultured"
merged.dat$Ingredient[merged.dat$Ingredient=="potato, red, fresh, with skin, medium, 2 1/4\" to 3 1/4\""] <- "potatoes, red, flesh and skin, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="celery stalk, fresh, medium, 7.5\" to 8\""] <- "celery, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef steak, bottom round, raw, 1/8 inch trim, urmis 1466"] <- "beef, round, bottom round, steak, separable lean and fat, trimmed to 1/8\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef, chuck, stew meat, raw, choice, urmis 1100"] <- "beef, chuck for stew, separable lean and fat, choice, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="lobster meat, can or cooked"] <- "crustaceans, lobster, northern, cooked, moist heat"
merged.dat$Ingredient[merged.dat$Ingredient=="vinegar, cide"] <- "vinegar, cider"
merged.dat$Ingredient[merged.dat$Ingredient=="lobster, cooked"] <- "crustaceans, lobster, northern, cooked, moist heat"
merged.dat$Ingredient[merged.dat$Ingredient=="beef roast, tenderloin, raw, 0\" trim"] <- "beef, loin, tenderloin roast, boneless, separable lean and fat, trimmed to 0\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="green onion, fresh, tops & bulb, medium,4 1/8\""] <- "onions, spring or scallions (includes tops and bulb), raw"
merged.dat$Ingredient[merged.dat$Ingredient=="soup, oyster stew, canned, prepared with equal volume wate"] <- "soup, oyster stew, canned, prepared with equal volume water"
merged.dat$Ingredient[merged.dat$Ingredient=="apples, raw, with skin"] <- "apples, raw, with skin (includes foods for usda's food distribution program)"
merged.dat$Ingredient[merged.dat$Ingredient=="lamb, ground, australian, raw, 15% fat"] <- "lamb, australian, ground, 85% lean / 15% fat, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="sherry,cooking"] <- "vinegar, red wine"
merged.dat$Ingredient[merged.dat$Ingredient=="bell pepper, green, fresh, medium, 2 1/2\""] <- "peppers, sweet, green, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beefsteak, bottom round, raw, 1/8 trim , urmis 1466"] <- "beef, round, bottom round, steak, separable lean and fat, trimmed to 1/8\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef steak, bottom round, raw, 1/8 trim , urmis 1466"] <- "beef, round, bottom round, steak, separable lean and fat, trimmed to 1/8\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="sauce, worcestershire\"\npacked in tomato juice"] <- "sauce, worcestershire"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, all pupose, self rising, enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, all purpose , self rising , enriched "] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, all purpose, self rising, enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, all purpose,self rising, enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, allpurpose, self rising,enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, allpurpose, selfrising, enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, allpurpose, selfrising,enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, allpurpose,self rising, enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour, bread, white, enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour,all purpose,self rising,enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="flour,bread,white,enriched"] <- "wheat flour, white, all-purpose, self-rising, enriched"
merged.dat$Ingredient[merged.dat$Ingredient=="garlic cloves,fresh"] <- "garlic, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="gelatin, dry, unsweetend"] <- "gelatin desserts, dry mix"
merged.dat$Ingredient[merged.dat$Ingredient=="gelatin, dry, unsweetened"] <- "gelatin desserts, dry mix"
merged.dat$Ingredient[merged.dat$Ingredient=="gelatin,dry,unsweetened"] <- "gelatin desserts, dry mix"
merged.dat$Ingredient[merged.dat$Ingredient=="gravy, beef, canned"] <- "gravy, beef, canned, ready-to-serve"
merged.dat$Ingredient[merged.dat$Ingredient=="green beans, fresh"] <- "beans, snap, green, raw"
merged.dat$Ingredient[merged.dat$Ingredient=='green onion, fresh, tops & bulb, medium,4 1/8\ "'] <- "onions, young green, tops only"
merged.dat$Ingredient[merged.dat$Ingredient=="green onion, fresh, tops & bulb,chopped"] <- "onions, young green, tops only"
merged.dat$Ingredient[merged.dat$Ingredient=="ham,cured,lean,8% fat"] <- "ham, sliced, regular (approximately 11% fat)"
merged.dat$Ingredient[merged.dat$Ingredient=="herring, atlantic, raw, fillet"] <- "fish, herring, atlantic, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="instant coffee,regular"] <- "beverages, coffee, instant, regular, prepared with water"
merged.dat$Ingredient[merged.dat$Ingredient=="jalapeno peppers,fresh"] <- 'peppers, jalapeno, canned, solids and liquids" "peppers, jalapeno, raw'
merged.dat$Ingredient[merged.dat$Ingredient=="juice, lemeon, fresh"] <- "lemon juice, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="juice, lemon, fresh"] <- "lemon juice, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="juice, tomato, canned , unsalted"] <- "tomato juice, canned, without salt added"
merged.dat$Ingredient[merged.dat$Ingredient=="kidney beans,canned"] <- "beans, kidney, all types, mature seeds, canned"
merged.dat$Ingredient[merged.dat$Ingredient=="lamb, ground, australian, raw, 15% fat"] <- "lamb, new zealand, imported, fore-shank, separable lean only, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="lobster meat, can or cooked"] <- "crustaceans, lobster, northern, cooked, moist heat"
merged.dat$Ingredient[merged.dat$Ingredient=="lobster, cooked"] <- "crustaceans, lobster, northern, cooked, moist heat"
merged.dat$Ingredient[merged.dat$Ingredient=="mashed potatoes, prepared from recipe with whole milk & butter"] <- "potatoes, mashed, home-prepared, whole milk and margarine added"
merged.dat$Ingredient[merged.dat$Ingredient=="mashed potatoes, prepared from recipe with whole milk and butter"] <- "potatoes, mashed, home-prepared, whole milk and margarine added"

merged.dat$Ingredient[merged.dat$Ingredient==" horseradish, prepared"] <- "horseradish, prepared"
merged.dat$Ingredient[merged.dat$Ingredient=="apple, refesh, sliced"] <- "apples, raw, with skin (includes foods for usda's food distribution program)"
merged.dat$Ingredient[merged.dat$Ingredient=="almonds, dry roastd, whole, unsalted"] <- "nuts, almonds, dry roasted, without salt added"
merged.dat$Ingredient[merged.dat$Ingredient=="apples, raw, with skin"] <- "apples, raw, with skin (includes foods for usda's food distribution program)"
merged.dat$Ingredient[merged.dat$Ingredient=="asparagus tips, fresh"] <- "asparagus, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="asparagus,canned,drained solids"] <- "asparagus, canned, drained solids"
merged.dat$Ingredient[merged.dat$Ingredient=="bacon, raw, cured"] <- "pork, cured, bacon, unprepared"
merged.dat$Ingredient[merged.dat$Ingredient=="bamboo shoots, canned, sliced, drained"] <- "bamboo shoots, canned, drained solids"
merged.dat$Ingredient[merged.dat$Ingredient=="beef roast, tenderloin, raw, 0\ trim\""] <- "beef, loin, tenderloin roast, boneless, separable lean and fat, trimmed to 0\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef steak, bottom round, raw, 1/8 inch trim, urmis 1466"] <- "beef, round, bottom round, steak, separable lean and fat, trimmed to 1/8\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef steak, bottom round, raw, 1/8 trim , urmis 1466"] <- "beef, round, bottom round, steak, separable lean and fat, trimmed to 1/8\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef, chuck, stew meat, raw, choice, urmis 1100"] <- "beef, chuck for stew, separable lean and fat, choice, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef, ground, raw, 10% fat"] <- "beef, ground, 90% lean meat / 10% fat, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef, ground, raw, 20% fat"] <- "beef, ground, 80% lean meat / 20% fat, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef,chuck,stew meat,raw,choice,urmis1100"] <- "beef, chuck for stew, separable lean and fat, choice, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beef,ground,raw,20%fat"] <- "beef, ground, 80% lean meat / 20% fat, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beefsteak, bottom round, raw, 1/8 trim , urmis 1466"] <- "beef, round, bottom round, steak, separable lean and fat, trimmed to 1/8\" fat, all grades, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="beer"] <- "alcoholic beverage, beer, regular, all"
merged.dat$Ingredient[merged.dat$Ingredient=="beets, pickled, caanned, sliced, in liquid"] <- "beets, pickled, canned, solids and liquids"
merged.dat$Ingredient[merged.dat$Ingredient=="bell pepper, green, fresh, chopped"] <- "peppers, sweet, green, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="bell pepper, green, fresh, medium, 2 1/2"] <- "peppers, sweet, green, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="bell pepper, green, fresh, medium, 2 1/2\ \""] <- "peppers, sweet, green, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="bell-pepper, green, fresh,chopped"] <- "peppers, sweet, green, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="brandy,90 proof"] <- "alcoholic beverage, distilled, all (gin, rum, vodka, whiskey) 90 proof"
merged.dat$Ingredient[merged.dat$Ingredient=="bread crumbs, plain, dry, grated"] <- "bread, crumbs, dry, grated, plain"
merged.dat$Ingredient[merged.dat$Ingredient=="bread crumbs, plain, dry,grated"] <- "bread, crumbs, dry, grated, plain"
merged.dat$Ingredient[merged.dat$Ingredient=="bread crumbs,plain,dry,grated"] <- "bread, crumbs, dry, grated, plain"
merged.dat$Ingredient[merged.dat$Ingredient=="bread,crumbs,dry,grated, plain"] <- "bread, crumbs, dry, grated, plain"
merged.dat$Ingredient[merged.dat$Ingredient=="broccoli, cooked, drained, chopped"] <- "broccoli, frozen, chopped, cooked, boiled, drained, without salt"
merged.dat$Ingredient[merged.dat$Ingredient=="brussels sprouts, cooked, drained"] <- "brussels sprouts, cooked, boiled, drained, without salt"
merged.dat$Ingredient[merged.dat$Ingredient=="brussels sprouts, fresh"] <- "brussels sprouts, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="butted, salted"] <- "butter, salted"
merged.dat$Ingredient[merged.dat$Ingredient=="butter,salted"] <- "butter, salted"
merged.dat$Ingredient[merged.dat$Ingredient=="cabbage, napa, fresh"] <- "cabbage, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="carrots, fresh, medium"] <- "carrots, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="carrots,fresh, chopped"] <- "carrots, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="cauliflower, fresh, medium head, 5 to 6"] <- "cauliflower, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="celery stalk, fresh, medium, 7.5 to 8 inch"] <- "celery, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="celery stalk, fresh, medium, 7.5\ to 8\" \""] <- "celery, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="celery, cooked, drained, diced"] <- "celery, cooked, boiled, drained, without salt"
merged.dat$Ingredient[merged.dat$Ingredient=="celery, fresh, diced"] <- "celery, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="celery, fresth,diced"] <- "celery, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="celery,fresh,diced"] <- "celery, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="cheese, gruyere, shredded"] <- "cheese, gruyere"
merged.dat$Ingredient[merged.dat$Ingredient=="cheese, swiss, shredded"] <- "cheese, swiss"
merged.dat$Ingredient[merged.dat$Ingredient=="cheese,cheddar,shredded"] <- "cheese, cheddar (includes foods for usda's food distribution program)"
merged.dat$Ingredient[merged.dat$Ingredient=="chestnuts, european, cooked"] <- "nuts, chestnuts, european, roasted"
merged.dat$Ingredient[merged.dat$Ingredient=="chestnuts, european, raw"] <- "nuts, chestnuts, european, raw, peeled"
merged.dat$Ingredient[merged.dat$Ingredient=="chicken dark meat, stewing, raw, skinless"] <- "chicken, roasting, dark meat, meat only, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="chicken thigh, braised, skinless"] <- "chicken, broilers or fryers, dark meat, thigh, meat only, cooked, braised"
merged.dat$Ingredient[merged.dat$Ingredient=="chicken, 60/40 white & dark meat, frozen, cooked, ready to pull,low sodium, food service"] <- "chicken, broilers or fryers, meat only, cooked, roasted"
merged.dat$Ingredient[merged.dat$Ingredient=="chicken, whole, raw with skin"] <- "chicken, broilers or fryers, meat and skin, raw"
merged.dat$Ingredient[merged.dat$Ingredient=="chocolate, dark, 45-59% cacao solids"] <- "chocolate, dark, 45- 59% cacao solids"
merged.dat$Ingredient[merged.dat$Ingredient=="coffee,brewed,with tap water"] <- "beverages, coffee, brewed, prepared with tap water"
merged.dat$Ingredient[merged.dat$Ingredient=="consomme, beef, canned, condensed"] <- "soup, beef broth bouillon and consomme, canned, condensed"
merged.dat$Ingredient[merged.dat$Ingredient=="corn, supersweet, yellow, streamfresh, forzen, kernels"] <- "corn, sweet, yellow, frozen, kernels cut off cob, unprepared (includes foods for usda's food distribution program)"
merged.dat$Ingredient[merged.dat$Ingredient=="crackers, saltine, crushed"] <- "crackers, saltines (includes oyster, soda, soup)"
merged.dat$Ingredient[merged.dat$Ingredient=="cream, fluid,heavy whipping"] <- "cream, fluid, heavy whipping"
merged.dat$Ingredient[merged.dat$Ingredient=="cream, whipping, heavy"] <- "cream, fluid, heavy whipping"
merged.dat$Ingredient[merged.dat$Ingredient=="cream,whipping,heavy"] <- "cream, fluid, heavy whipping"
# There is no demi glace in the Food_Des file
merged.dat$Ingredient[merged.dat$Ingredient=="demi glace sauce concentrate, master's touch, 1263, food service"] <- "soup, beef broth bouillon and consomme, canned, condensed	"
merged.dat$Ingredient[merged.dat$Ingredient=="egg white, raw, large"] <- "egg, white, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg white,raw,large"] <- "egg, white, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg yolk, raw, large"] <- "egg, yolk, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg yolk,raw,large"] <- "egg, yolk, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg york, raw, large"] <- "egg, yolk, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg, raw"] <- "egg, whole, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg,raw"] <- "egg, whole, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="egg,whole,raw,fresh"] <- "egg, whole, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="eggyolk, raw, large"] <- "egg, yolk, raw, fresh"
merged.dat$Ingredient[merged.dat$Ingredient=="extract, vanilla"] <- "vanilla extract"
merged.dat$Ingredient[merged.dat$Ingredient=="extract,vanilla"] <- "vanilla extract"
merged.dat$Ingredient[merged.dat$Ingredient=="fat, bacon, cooked, rendered"] <- "pork, bacon, rendered fat, cooked"
merged.dat$Ingredient[merged.dat$Ingredient=="fat,bacon,cooked,rendered"] <- "pork, bacon, rendered fat, cooked"
```

*Updating NDB_Nos that are NA.*
```{r}
# I am changing Log_Desc and ingredient to character and lower case so it is easy to compare
Food_Des$Long_Desc <- tolower(as.character(Food_Des$Long_Desc))
merged.dat$Ingredient <- tolower(as.character(merged.dat$Ingredient))

# Creating temporary data for all the NDB_No NA
b <- merged.dat[is.na(merged.dat$NDB_No)==TRUE,]

# Merging temp data set to food and getting ingredient and relative NDB_No
b.dat <- merge(b,  Food_Des, by.x= "Ingredient", by.y = "Long_Desc")
b.ing <- b.dat$Ingredient
b.ndb <- b.dat$NDB_No.y

# I also created data frame because updating using vectors only worked for about 100 records.
b.dat <- unique(data.frame(cbind(Ingredient= b.dat$Ingredient, NDB_No =b.dat$NDB_No.y), stringsAsFactors = FALSE))

# Converting data frames NDB_No to integer
b.dat$NDB_No <- as.integer(b.dat$NDB_No)
```

*Using a combination of loops to update all NDB_No.*
```{r}
# loop to update NDB_No based on ingredients
# I am using vectors here . I tried out with data frame but wasnt working.
# I changed logic and using vectors to update NDB_No
# Loop goes from all rows of merged.dat and checks if the NDB_No is NA
# IF NA is found it starts another loop going through vector ingredient
# If it finds matching ingredient, then it finds relative NDB_No using index and updates NDB_No

for (i in 1: nrow(merged.dat)){
  if (is.na(merged.dat$NDB_No[i])){
    for (j in 1: length(b.ing)){
      if (merged.dat$Ingredient[i] ==  b.ing[j]) {
        merged.dat$NDB_No[i] <- b.ndb[j]
      }
     }
  }
}

# Loop goes thorugh b.dat data frame and then loops through merged data frame
# IF it finds NDB_No NA and if ingredient name matches it updates NDB_No

for (i in 1: nrow(b.dat)){
  for (j in 1: nrow(merged.dat)){
     if (is.na(merged.dat$NDB_No[j])== TRUE  && is.na(merged.dat$Ingredient[j]) == FALSE){
           if(( merged.dat$Ingredient[j] %in% b.dat$Ingredient[i]) == TRUE){
             merged.dat$NDB_No[j] <- b.dat$NDB_No[i] 
           }
     }
  }
}

# Earlier loops did not update all the records so 
# I am going to try using like 
# Logic will be the same as above

for (i in 1: nrow(merged.dat)){
  if (is.na(merged.dat$NDB_No[i])){
    for (j in 1: length(b.ing)){
      if (merged.dat$Ingredient[i] %in%  b.ing[j]) {
        merged.dat$NDB_No[i] <- b.ndb[j]
      }
     }
  }
}
```

*Analyzing outputs to see what, if any, NA values still exist.*
```{r}
merged.dat[is.na(merged.dat$NDB_No)==TRUE,]
sum(is.na(merged.dat$Amount))
sum(is.na(merged.dat$Measure))
sum(is.na(merged.dat$Ingredient))
sum(is.na(merged.dat$NDB_No)) #31 NDBs still at NA
nrow(merged.dat) #1,040 rows - hasn't changed since line 237 which is what we want
```

*Deleting recipes where NDB_No is still NA*
```{r}
# We are deleting recipes where one or more 'NDB_No' values are missing
library(dplyr)
merged.dat <-
  merged.dat %>%
  group_by(Recipe,Year) %>%
  filter(!any(is.na(NDB_No)))

nrow(merged.dat) #888 rows
length(merged.dat$NDB_No[is.na(merged.dat$NDB_No)])  #0 NDB_No values left
```

*Beginning to merge data to calculate grams.*
```{r}
#combined the merged.dat data set with the Weight data set to begin calculating Grams per Ingredient
grams.dat <- merge(merged.dat,Weight, by = "NDB_No")
grams.dat <- grams.dat[with(grams.dat, order(grams.dat$Recipe, grams.dat$Year)),]
nrow(grams.dat) #2,949 rows
```

*Standardizing the 'Measure' column with the 'Msre_Desc' column.*
```{r}
# Here I fixed many common errors made in defining 'Measure' column to maximize our useable data
# All conversions were done through convert-me.com, thecalculatorsite.com, and MyFitnessPal 
for (i in 1:nrow(grams.dat)) {
  if (grams.dat$Measure[i] == 'tsp') {
  if (grams.dat$NDB_No[i] == 1001) {
    grams.dat$Measure[i] <- 'tbsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/3  #3 tsp in tablespoon
  }
  }
  if (grams.dat$Measure[i] == 'ea') {
  if (grams.dat$NDB_No[i] == 9003) {
    grams.dat$Measure[i] <- 'medium (3" dia)'
  }
  }
  if (grams.dat$Measure[i] == 'tbsp') {
  if (grams.dat$NDB_No[i] == 19908) {
    grams.dat$Measure[i] <- 'tsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3  #3 tsp in tablespoon
  }
  }
  if (grams.dat$Measure[i] == 'tbsp') {
  if (grams.dat$NDB_No[i] == 11693) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 9152) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 20027) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 20084) {
    grams.dat$Measure[i] <- 'cup unsifted, dipped'
  }
  }
  if (grams.dat$Measure[i] == 'tbsp') {
  if (grams.dat$NDB_No[i] == 20084) {
    grams.dat$Measure[i] <- 'cup unsifted, dipped'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 6559) {
    grams.dat$Measure[i] <- 'serving 1 cup'
  }
  }
  if (grams.dat$Measure[i] == 'lb') {
  if (grams.dat$NDB_No[i] == 9003) {
    grams.dat$Measure[i] <- 'medium (3" dia)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3 #3 medium apples make a pound
  }
  }
  if (grams.dat$Measure[i] == 'tbsp') {
  if (grams.dat$NDB_No[i] == 20082) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] == 'ea') {
  if (grams.dat$NDB_No[i] == 1125) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] == 'lrg') {
  if (grams.dat$NDB_No[i] == 1125) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] == 'ea') {
  if (grams.dat$NDB_No[i] == 11011) {
    grams.dat$Measure[i] <- 'spear, medium (5-1/4" to 7" long)'
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 1040) {
    grams.dat$Measure[i] <- 'cup, shredded'
  }
  }
  if (grams.dat$Measure[i] == 'tbsp') {
  if (grams.dat$NDB_No[i] == 11286) {
    grams.dat$Measure[i] <- 'cup chopped'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 9152) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/48  #48 tsp in cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 19335) {
    grams.dat$Measure[i] <- 'tsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3 #3 tsp in tablespoon
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 1053) {
    grams.dat$Measure[i] <- 'cup, fluid (yields 2 cups whipped)'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 12142) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 19078) {
    grams.dat$Measure[i] <- 'oz square Bakers'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 14555) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 14429) {
    grams.dat$Measure[i] <- 'fl oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/8  #8 fluid oz in cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 14429) {
    grams.dat$Measure[i] <- 'fl oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*2
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 18423) {
    grams.dat$Measure[i] <- 'ladyfinger'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 19177) {
    grams.dat$Measure[i] <- 'envelope (1 tbsp)'
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 19177) {
    grams.dat$Measure[i] <- 'envelope (1 tbsp)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/3  #3 tsp in 1 tablespoon
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 7074) {
    grams.dat$Measure[i] <- 'link, little (2" long x 3/4" dia)'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 5006) {
    grams.dat$Measure[i] <- 'unit (yield from 1 lb ready-to-cook chicken)'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11143) {
    grams.dat$Measure[i] <- 'cup chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11286) {
    grams.dat$Measure[i] <- 'cup chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11291) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11333) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11803) {
    grams.dat$Measure[i] <- 'cup slices'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 7019) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11529) {
    grams.dat$Measure[i] <- 'cup, chopped or sliced'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11333) {
    grams.dat$Measure[i] <- 'medium (approx 2-3/4" long, 2-1/2" dia)'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 11885) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/8  #8 oz in cup
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 5013) {
    grams.dat$Measure[i] <- 'unit (yield from 1 lb ready-to-cook chicken)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 6956) {
    grams.dat$Measure[i] <- 'can 10.7 oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/10.7
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 10864) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*2  #2 fluid oz in a tbsp
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 16029) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/8  #8 oz in a cup
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 23572) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 19172) {
    grams.dat$Measure[i] <- 'package (3 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/18  #6 tsp in 1 fluid oz
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 1211) {
    grams.dat$Measure[i] <- 'fl oz'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 20083) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 1124) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 14209) {
    grams.dat$Measure[i] <- 'cup (8 fl oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 5672) {
    grams.dat$Measure[i] <- 'thigh without skin'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 10062) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 lb in oz
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 14209) {
    grams.dat$Measure[i] <- 'cup (8 fl oz)'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 19172) {
    grams.dat$Measure[i] <- 'package (3 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/6  #6 tbsp in 3 fluid oz
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 14215) {
    grams.dat$Measure[i] <- 'fl oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/2  #2 tbsp in fluid oz
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11459) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*10  #10 cups of spinach to make lb
  }
  }
  if (grams.dat$Measure[i] =='slice') {
  if (grams.dat$NDB_No[i] == 10123) {
    grams.dat$Measure[i] <- 'slice raw'
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 11287) {
    grams.dat$Measure[i] <- 'package (10 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/6  #6 tsp in 10 oz
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 20082) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/48  #48 tsp in cup
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11206) {
    grams.dat$Measure[i] <- 'cup, sliced'
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 2046) {
    grams.dat$Measure[i] <- 'tsp or 1 packet'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 4053) {
    grams.dat$Measure[i] <- 'tablespoon'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11287) {
    grams.dat$Measure[i] <- 'package (10 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*.8  #8 oz in a cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 12061) {
    grams.dat$Measure[i] <- 'cup, sliced'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 18325) {
    grams.dat$Measure[i] <- 'oz'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 9250) {
    grams.dat$Measure[i] <- 'cup, thawed'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 9250) {
    grams.dat$Measure[i] <- 'package (10 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*1.6  #16 oz in pound
  }
  }
  if (grams.dat$Measure[i] =='pce') {
  if (grams.dat$NDB_No[i] == 10123) {
    grams.dat$Measure[i] <- 'slice raw'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11365) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3.5  #3.5 cups of medium potatoes equal 1 pound
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11937) {
    grams.dat$Measure[i] <- 'cup, chopped or diced'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11352) {
    grams.dat$Measure[i] <- 'cup, diced'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3.5  #3.5 cups of medium potatoes equal 1 pound
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11052) {
    grams.dat$Measure[i] <- 'cup 1/2\ pieces"'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3  #3 of green beans cups equals 1 lb
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11286) {
    grams.dat$Measure[i] <- 'cup chopped'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 6043) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/8  #8 oz in cup
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 7026) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*8  #8 oz in cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 7254) {
    grams.dat$Measure[i] <- 'serving'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 9266) {
    grams.dat$Measure[i] <- 'cup, chunks'
  }
  }
  if (grams.dat$Measure[i] =='whole') {
  if (grams.dat$NDB_No[i] == 9266) {
    grams.dat$Measure[i] <- 'fruit'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 9266) {
    grams.dat$Measure[i] <- 'fruit'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/32 # a pineapple is approximately 32 ounces
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 9321) {
    grams.dat$Measure[i] <- 'cup, pulp'
  }
  }
  if (grams.dat$Measure[i] =='whole') {
  if (grams.dat$NDB_No[i] == 11352) {
    grams.dat$Measure[i] <- 'cup, diced'
  }
  }
  if (grams.dat$Measure[i] =='whole') {
  if (grams.dat$NDB_No[i] == 43285) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*2 #2 liquid oz per whole egg
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 11352) {
    grams.dat$Measure[i] <- 'cup, diced'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/8  #8 oz in cup
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 2030) {
    grams.dat$Measure[i] <- 'tsp, ground'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 1077) {
    grams.dat$Measure[i] <- 'cup'
  }
  }
  if (grams.dat$Measure[i] =='large') {
  if (grams.dat$NDB_No[i] == 1123) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] =='cup diced') {
  if (grams.dat$NDB_No[i] == 11265) {
    grams.dat$Measure[i] <- 'cup diced'
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 6971) {
    grams.dat$Measure[i] <- 'tbsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/3  #3 tsp in tablespoon
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 7938) {
    grams.dat$Measure[i] <- 'oz (1 serving)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 17142) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 9014) {
    grams.dat$Measure[i] <- 'cup slices'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11109) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 10123) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 6982) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*2  #1 lb equals approx. 2 cups of soup
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11124) {
    grams.dat$Measure[i] <- 'cup chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11564) {
    grams.dat$Measure[i] <- 'cup, cubes'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11365) {
    grams.dat$Measure[i] <- 'cup'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11373) {
    grams.dat$Measure[i] <- 'cup'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11367) {
    grams.dat$Measure[i] <- 'cup'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11240) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*7  #1 lb equals approx. 7 cups of mushrooms
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 18069) {
    grams.dat$Measure[i] <- 'cup, crumbs'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 2028) {
    grams.dat$Measure[i] <- 'tsp'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 2047) {
    grams.dat$Measure[i] <- 'tsp'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 3115) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*8  #8 oz in cup
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11591) {
    grams.dat$Measure[i] <- 'sprig'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11937) {
    grams.dat$Measure[i] <- 'spear, small'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 14411) {
    grams.dat$Measure[i] <- 'serving 8 fl oz'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 15147) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*8  #8oz in cup
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 2028) {
    grams.dat$Measure[i] <- 'tbsp'
  }
  } 
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 4708) {
    grams.dat$Measure[i] <- 'tbsp'
  }
  } 
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 6168) {
    grams.dat$Measure[i] <- 'tsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*48  #48 tsp in cup
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 9150) {
    grams.dat$Measure[i] <- 'fruit (2-3/8 dia)"'
  }
  } 
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 9152) {
    grams.dat$Measure[i] <- 'fl oz'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 43154) {
    grams.dat$Measure[i] <- 'fl oz'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11282) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11282) {
    grams.dat$Measure[i] <- 'serving 1 cup'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 10972) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11282) {
    grams.dat$Measure[i] <- 'cup, sliced'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11670) {
    grams.dat$Measure[i] <- 'pepper'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 18621) {
    grams.dat$Measure[i] <- 'cracker'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 23562) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='each') {
  if (grams.dat$NDB_No[i] == 11209) {
    grams.dat$Measure[i] <- 'eggplant, unpeeled (approx 1-1/4 lb)'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 17224) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='lrg') {
  if (grams.dat$NDB_No[i] == 1123) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 1256) {
    grams.dat$Measure[i] <- 'container'
  }
  }
  if (grams.dat$Measure[i] =='tbs') {
  if (grams.dat$NDB_No[i] == 4053) {
    grams.dat$Measure[i] <- 'tablespoon'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11209) {
    grams.dat$Measure[i] <- 'eggplant, unpeeled (approx 1-1/4 lb)'
  }
  }
  if (grams.dat$Measure[i] =='each') {
  if (grams.dat$NDB_No[i] == 11215) {
    grams.dat$Measure[i] <- 'clove'
  }
  }
  if (grams.dat$Measure[i] =='each') {
  if (grams.dat$NDB_No[i] == 11286) {
    grams.dat$Measure[i] <- 'cup chopped'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 11531) {
    grams.dat$Measure[i] <- 'tbsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*2  #1 oz equals 2 tbsp
  }
  }
  if (grams.dat$Measure[i] =='tbs') {
  if (grams.dat$NDB_No[i] == 11546) {
    grams.dat$Measure[i] <- 'tbsp'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11371) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11144) {
    grams.dat$Measure[i] <- 'cup, diced'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11238) {
    grams.dat$Measure[i] <- 'piece whole'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*22  # there are 20-24 mushrooms per pound
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 1023) {
    grams.dat$Measure[i] <- 'cup, shredded'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 1023) {
    grams.dat$Measure[i] <- 'cup pieces'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11294) {
    grams.dat$Measure[i] <- 'onion'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11641) {
    grams.dat$Measure[i] <- 'cup, sliced'
  }
  }
  if (grams.dat$Measure[i] =='tbs') {
  if (grams.dat$NDB_No[i] == 1001) {
    grams.dat$Measure[i] <- 'tbsp'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11135) {
    grams.dat$Measure[i] <- 'head medium (5-6 dia.)"'
  }
  }
  if (grams.dat$Measure[i] == 'tbs') {
  if (grams.dat$NDB_No[i] == 20082) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 2054) {
    grams.dat$Measure[i] <- 'tbsp, drained'
  }
  }
  if (grams.dat$Measure[i] == 'lb') {
  if (grams.dat$NDB_No[i] == 15141) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] == 'lb') {
  if (grams.dat$NDB_No[i] == 17142) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11282) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 19336) {
    grams.dat$Measure[i] <- 'cup sifted'
  }
  }
  if (grams.dat$Measure[i] == 'lb') {
  if (grams.dat$NDB_No[i] == 9297) {
    grams.dat$Measure[i] <- 'cup, packed'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3  # 3 cups in a lb of raisins
  }
  }
  if (grams.dat$Measure[i] == 'lb') {
  if (grams.dat$NDB_No[i] == 13335) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 14551) {
    grams.dat$Measure[i] <- 'fl oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*8  #8 fl oz in cup
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 9297) {
    grams.dat$Measure[i] <- 'cup, packed'
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 19334) {
    grams.dat$Measure[i] <- 'cup packed'
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 9087) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 12154) {
    grams.dat$Measure[i] <- 'cup, chopped'
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 1009) {
    grams.dat$Measure[i] <- 'cup, shredded'
  }
  }
  if (grams.dat$Measure[i] == 'oz') {
  if (grams.dat$NDB_No[i] == 32001) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/8  #8 fl oz in a cup
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 11026) {
    grams.dat$Measure[i] <- 'cup (1/2 pieces)"'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11143) {
    grams.dat$Measure[i] <- 'stalk, medium (7-1/2 - 8" long)"'
  }
  }
  if (grams.dat$Measure[i] == 'lb') {
  if (grams.dat$NDB_No[i] == 11260) {
    grams.dat$Measure[i] <- 'cup, whole'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*22 # there are 20-24 mushrooms per pound
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 11261) {
    grams.dat$Measure[i] <- 'cup pieces'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11292) {
    grams.dat$Measure[i] <- 'stalk'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11979) {
    grams.dat$Measure[i] <- 'pepper'
  }
  }
  if (grams.dat$Measure[i] == 'cup') {
  if (grams.dat$NDB_No[i] == 11260) {
    grams.dat$Measure[i] <- 'cup, whole'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11291) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11734) {
    grams.dat$Measure[i] <- 'cup slices'
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 11734) {
    grams.dat$Measure[i] <- 'beets (2 dia, sphere)"'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*4 # there are 4 medium beets per pound
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11337) {
    grams.dat$Measure[i] <- 'package (10 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/2 # 1 cup is approx 5 ounces
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 13485) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16  #16 oz in lb
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 11215) {
    grams.dat$Measure[i] <- 'clove'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 14096) {
    grams.dat$Measure[i] <- 'fl oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*8  #8 fluid oz in cup
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 9354) {
    grams.dat$Measure[i] <- 'cup, chunks'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 11876) {
    grams.dat$Measure[i] <- 'cup, mashed'
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 20068) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='irg') {
  if (grams.dat$NDB_No[i] == 1123) {
    grams.dat$Measure[i] <- 'large'
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 19198) {
    grams.dat$Measure[i] <- 'portion, amount to make 1/2 cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*2 
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 19198) {
    grams.dat$Measure[i] <- 'portion, amount to make 1/2 cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/32  #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='pieces') {
  if (grams.dat$NDB_No[i] == 11143) {
    grams.dat$Measure[i] <- 'stalk, medium (7-1/2 - 8" long)"'
  }
  }
  if (grams.dat$Measure[i] =='pieces') {
  if (grams.dat$NDB_No[i] == 9038) {
    grams.dat$Measure[i] <- 'fruit, without skin and seed'
  }
  }
  if (grams.dat$Measure[i] =='oz') {
  if (grams.dat$NDB_No[i] == 19703) {
    grams.dat$Measure[i] <- 'package (0.35 oz)'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*3  #0.35 * 3 is approx. 1
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 15121) {
    grams.dat$Measure[i] <- 'cup, solid or chunks'
  }
  }
  if (grams.dat$Measure[i] =='ea') {
  if (grams.dat$NDB_No[i] == 1160) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*.6  # egg yolks are approximately .6oz
  }
  }
  if (grams.dat$Measure[i] =='tbsp') {
  if (grams.dat$NDB_No[i] == 20081) {
    grams.dat$Measure[i] <- 'cup'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/16 #16 tbsp in cup
  }
  }
  if (grams.dat$Measure[i] =='lb') {
  if (grams.dat$NDB_No[i] == 1009) {
    grams.dat$Measure[i] <- 'oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*16 #16 oz in lb 
  }
  }
  if (grams.dat$Measure[i] =='cup') {
  if (grams.dat$NDB_No[i] == 14003) {
    grams.dat$Measure[i] <- 'fl oz'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]*8 #8 fl oz in cup
  }
  }
  if (grams.dat$Measure[i] =='tsp') {
  if (grams.dat$NDB_No[i] == 6971) {
    grams.dat$Measure[i] <- 'tbsp'
    grams.dat$Amount.x[i] <- grams.dat$Amount.x[i]/3  #3 tsp in tablespoon
  }
  }
}
head(grams.dat)  # now we can see that 'Amount.x' and 'Measure' have been updated to corrolate 'Msre_Desc' values from 'Weights' table
```

*Deleting rows leaving only the rows that have the correct 'Measure' and 'Msre_Desc' values.*
```{r}
# Now we want to delete the extra rows where 'Measure' doesn't match 'Msre_Desc' in grams.dat
grams.dat$Msre_Desc <- as.character(grams.dat$Msre_Desc)
grams.dat <- subset(grams.dat, grams.dat$Measure == grams.dat$Msre_Desc)

nrow(grams.dat) #862 - we lost 26 (2%) of the ingredients that either didn't have a match or the NDB_No didn't correspond to the correct ingredient. 
```

*Finalizing the Grams calculation.*
```{r}
# Creating gramscalc.dat dataframe with essential colums to calculate the grams per ingredient

gramscalc.dat <- grams.dat[,c("NDB_No","Recipe","Year","Amount.x", "Measure","Ingredient","Gm_Wgt")]
colnames(gramscalc.dat)[4] <- "Amount"

# Creating new column for grams and calculating it
gramscalc.dat$Grams <- NA
gramscalc.dat$Grams <- gramscalc.dat$Amount*gramscalc.dat$Gm_Wgt

# Dropping Gm_Wgt now that we have grams calculated
gramscalc.dat$Gm_Wgt <- NULL

# Deleting recipes for which we don't have both y1936 and 2006 data to compare
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="ChickenGumbo",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="ChiliconCarne",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="ChocolateBavarianCream",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="ChowMein",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="GermanPotatoSalad",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="RolledBiscuits",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="Seafoodsalad",] 
gramscalc.dat <- gramscalc.dat[gramscalc.dat$Recipe!="ShepherdsPie",] 

# Here we check to see if any of the below columns contain an NA
sum(is.na(gramscalc.dat$Amount))
sum(is.na(gramscalc.dat$Measure))
sum(is.na(gramscalc.dat$Ingredient))
sum(is.na(gramscalc.dat$NDB_No))
sum(is.na(gramscalc.dat$Grams))
nrow(gramscalc.dat) # 805 rows of data
```

*Recipes available for analysis.*
```{r}
# Getting a list of recipes that are available for analysis
final.recipes.dat <- unique(gramscalc.dat[,c("Recipe", "Year")])

nrow(final.recipes.dat)  #126 recipes available
```

##Compare methods of calculating calories. John Becker used the ESHA database to compute calories. A simpler, but more commonly used formula, is CHO=4calories/gm; PRO=4,FAT=9. Compute total calories for each recipe using both formula and compare with a scatterplot, you might also include a linear regression. Is there a bias in one method versus the other? Subset the data to include only the recipes Wansink used - can you determine which method Wansink used to calculate total calories?

*Starting by creating ESHA.calc that will utilize John Becker's method to compute calories.*
```{r}
# merged gramscalc.dat with Food_Des and ordered the rows
ESHA.calc <- merge(gramscalc.dat,Food_Des, by = "NDB_No")
ESHA.calc <- ESHA.calc[with(ESHA.calc, order(ESHA.calc$Recipe, ESHA.calc$Year)),]

# created columns for calorie totals from each of the 3 factors in Food_Des and their corresponding ESHA values
ESHA.calc$Pro_Calories <- NA
ESHA.calc$Fat_Calories <- NA
ESHA.calc$CHO_Calories <- NA
ESHA.calc$TotalCalories <- NA

#organized table with only the necessary columns
ESHA.calc <- ESHA.calc[,c("NDB_No","Recipe","Year","Amount", "Measure","Ingredient","Grams","TotalCalories","Pro_Calories","Fat_Calories","CHO_Calories","Pro_Factor","Fat_Factor","CHO_Factor")]

# used 'complete.cases' to remove rows that had NA for Pro_Factor, Fat_Factor and CHO_Factor
ESHA.calc <- ESHA.calc[complete.cases(ESHA.calc$Pro_Factor,ESHA.calc$Fat_Factor,ESHA.calc$CHO_Factor),]

nrow(ESHA.calc) #587 rows
```

*Created basic.calc which uses the more common 4-4-9 method to compute calories.*
```{r}
# merged gramscalc.dat with Food_Des and ordered the rows
basic.calc <- merge(gramscalc.dat,Food_Des, by="NDB_No")
basic.calc <- basic.calc[with(basic.calc, order(basic.calc$Recipe, basic.calc$Year)),]

# used 'complete.cases' to remove rows that had NA for Pro_Factor, Fat_Factor and CHO_Factor in to get an equal comparison to 'ESHA.calc' 
basic.calc <- basic.calc[complete.cases(basic.calc$Pro_Factor,basic.calc$Fat_Factor,basic.calc$CHO_Factor),]

# created columns for calorie totals from each of the 3 factors in Food_Des and their corresponding "simple" values of the 4-4-9 method
basic.calc$Pro_Calories <- NA
basic.calc$Fat_Calories <- NA
basic.calc$CHO_Calories <- NA
basic.calc$TotalCalories <- NA
basic.calc$Simple_Pro <- c(4)
basic.calc$Simple_Fat <- c(9)
basic.calc$Simple_CHO <- c(4)

#organized table with only the necessary columns
basic.calc <- basic.calc[,c("NDB_No","Recipe","Year","Amount", "Measure","Ingredient","Grams","TotalCalories","Pro_Calories","Fat_Calories","CHO_Calories","Simple_Pro","Simple_Fat","Simple_CHO")]

nrow(basic.calc) #587 rows
```

*Merging Nut_Data with ESHA.calc to calculate calories per ingredient using John Becker's methodology.*
```{r}
# Load and format NUT_DAT table as 'NUT'
NUT_pro <- Nut_Data[Nut_Data$Nutr_No==203,]
NUT_fat <- Nut_Data[Nut_Data$Nutr_No==204,]
NUT_cho <- Nut_Data[Nut_Data$Nutr_No==205,]
NUT <- rbind(NUT_pro, NUT_fat, NUT_cho)
head(NUT)

# merged nut data to ESHA.calc based on NDB_No
ESHA.calc <- merge(ESHA.calc,NUT,all.x=TRUE,by=c("NDB_No"))

#organized table with only the necessary columns
ESHA.calc <- ESHA.calc[,c("NDB_No","Recipe","Year","Amount", "Measure","Ingredient","Grams","TotalCalories","Pro_Calories","Fat_Calories","CHO_Calories","Pro_Factor","Fat_Factor","CHO_Factor","Nutr_No","Nutr_Val")]
nrow(ESHA.calc) #1,761 rows (1,761 / 3 = 587 from above)-divide by 3 because of rows for 203,204,205 Nutr_Nos
```

*Merging Nut_Data with basic.calc to calculate calories per ingredient using the more common 4-4-9 methodology.*
```{r}
# merged nut data to basic.calc based on NDB_No
basic.calc <- merge(basic.calc,NUT,all.x=TRUE,by=c("NDB_No"))

#organized table with only the necessary columns
basic.calc <- basic.calc[,c("NDB_No","Recipe","Year","Amount", "Measure","Ingredient","Grams","TotalCalories","Pro_Calories","Fat_Calories","CHO_Calories","Simple_Pro","Simple_Fat","Simple_CHO","Nutr_No","Nutr_Val")]
nrow(basic.calc) #1,761 rows (1,761 / 3 = 587 from above)
```


```{r}
# Calculating calories using ESHA factors
for (i in 1:nrow(ESHA.calc)) {
  if (ESHA.calc$Nutr_No[i]==203) {
    ESHA.calc$Pro_Calories[i] <- (ESHA.calc$Nutr_Val[i] / 100) * ESHA.calc$Grams[i] * ESHA.calc$Pro_Factor[i]
    ESHA.calc$TotalCalories[i] <- ESHA.calc$Pro_Calories[i]
  }
  else if (ESHA.calc$Nutr_No[i]==204) {
    ESHA.calc$Fat_Calories[i] <- (ESHA.calc$Nutr_Val[i] / 100) * ESHA.calc$Grams[i] * ESHA.calc$Fat_Factor[i]
    ESHA.calc$TotalCalories[i] <- ESHA.calc$Fat_Calories[i]
  }
  else {
    ESHA.calc$CHO_Calories[i] <- (ESHA.calc$Nutr_Val[i] / 100) * ESHA.calc$Grams[i] * ESHA.calc$CHO_Factor[i]
    ESHA.calc$TotalCalories[i] <- ESHA.calc$CHO_Calories[i]
  }
}
ESHA.calc[is.na(ESHA.calc)] <- 0
 

# Calculating calories using Simple factors
for (i in 1:nrow(basic.calc)) {
  if (basic.calc$Nutr_No[i]==203) {
    basic.calc$Pro_Calories[i] <- (basic.calc$Nutr_Val[i] / 100) * basic.calc$Grams[i] * basic.calc$Simple_Pro[i]
    basic.calc$TotalCalories[i] <- basic.calc$Pro_Calories[i]
  }
  else if (basic.calc$Nutr_No[i]==204) {
    basic.calc$Fat_Calories[i] <- (basic.calc$Nutr_Val[i] / 100) * basic.calc$Grams[i] * basic.calc$Simple_Fat[i]
    basic.calc$TotalCalories[i] <- basic.calc$Fat_Calories[i]
  }
  else {
    basic.calc$CHO_Calories[i] <- (basic.calc$Nutr_Val[i] / 100) * basic.calc$Grams[i] * basic.calc$Simple_CHO[i]
    basic.calc$TotalCalories[i] <- basic.calc$CHO_Calories[i]
  }
}
basic.calc[is.na(basic.calc)] <- 0


nrow(ESHA.calc)  #1,761 rows
nrow(basic.calc)  #1,761 rows
```

*Calculating total calories per recipe for each recipe using both the ESHA and 4-4-9 methods.*
```{r}
#Use aggregate function to aggregate both tables TotalCalories by Recipe & Year, then ordering by Recipe & Year
ESHA.recipe.calc <- aggregate(TotalCalories ~ Recipe + Year, data = ESHA.calc, FUN = sum)
ESHA.recipe.calc <- ESHA.recipe.calc[with(ESHA.recipe.calc, order(ESHA.recipe.calc$Recipe, ESHA.recipe.calc$Year)),]
basic.recipe.calc <- aggregate(TotalCalories ~ Recipe + Year, data = basic.calc, FUN = sum)
basic.recipe.calc <- basic.recipe.calc[with(basic.recipe.calc, order(basic.recipe.calc$Recipe, basic.recipe.calc$Year)),]

nrow(ESHA.recipe.calc) #126 (same as final.recipes.dat)
nrow(basic.recipe.calc) #126 (same as final.recipes.dat)
```

*Using scatterplot to compare the ESHA and 4-4-9 methods of calculating calories.*
```{r}
library(ggplot2)
library(gridExtra)

# combining the two data sets for the scatter plot
combined.recipe.calc <- merge(ESHA.recipe.calc, basic.recipe.calc, by = 'Recipe')

# scatterplots for each data set - removed axis x ticks because of amount of data
# color coded by year for easier comparison
ESHA.plot <- 
  ggplot(ESHA.recipe.calc, aes(x=Recipe, y=TotalCalories)) +
  geom_point(aes(colour = Year)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank()) +
  ggtitle("ESHA Total Calories") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_hline(aes(yintercept = mean(TotalCalories)))
Basic.plot <-
  ggplot(basic.recipe.calc, aes(x=Recipe, y=TotalCalories)) +
  geom_point(aes(colour = Year)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())+
  ggtitle("4-4-9 Total Calories") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_hline(aes(yintercept = mean(TotalCalories)))

# from 'gridExtra' library - used ncol=1 to get wider plots to better visualize data
grid.arrange(ESHA.plot, Basic.plot, ncol=1)

# boxplots to show distribution of Total Calories by year for each method
ESHA.boxplot <- 
  ggplot(ESHA.recipe.calc, aes(x=Year, y=TotalCalories)) +
  geom_boxplot(outlier.colour = "red",(aes(fill = Year))) +
  coord_cartesian(ylim = c(0, 15000)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank()) +
  ggtitle("ESHA Total Calories") +
  theme(plot.title = element_text(hjust = 0.5))
Basic.boxplot <-
  ggplot(basic.recipe.calc, aes(x=Year, y=TotalCalories)) +
  geom_boxplot(outlier.colour = "red",(aes(fill = Year))) +
  coord_cartesian(ylim = c(0, 15000)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())+
  ggtitle("4-4-9 Total Calories") +
  theme(plot.title = element_text(hjust = 0.5))

grid.arrange(ESHA.boxplot, Basic.boxplot, ncol=1)
```

#Analysis for comparison of ESHA method vs. 4-4-9 Method

*The scatterplots show pretty good correlation between the two methods, which is to be expected. The 4-4-9 method appears to result in a slightly higher Total Calorie value more often than not. The horizontal line on the scatterplots shows that the mean for Total Calories, accross all recipes, is slightly higher using the 4-4-9 method which is also what we expected.*

*Boxplots were also added to visualize the data, and outliers, by year. Both methods produce similar results with a slightly higher median in the 2006. Both methods produce the same number of outliers (5) for each year of data.*



*Linear Regression for 'ESHA.recipe.calc*
```{r}
# creating 'ESHA' data in the wide form
# I was going to use it for linear regression but data do not look good for regression
# I was not able to aggregate it and collapse in one column without error so I used different route as below in next steps
ESHA.wide <- reshape(ESHA.recipe.calc[c("Recipe","Year","TotalCalories")],
idvar=c("Recipe","Year"),
direction="wide",
v.names="TotalCalories",
timevar="Year")


ESHA.1935 <- ESHA.recipe.calc[ESHA.recipe.calc$Year==1936,]
ESHA.2006 <- ESHA.recipe.calc[ESHA.recipe.calc$Year==2006,]

# replacing NA values with
ESHA.wide$TotalCalories.1936[is.na(ESHA.wide$TotalCalories.1936)] <- 0
ESHA.wide$TotalCalories.2006[is.na(ESHA.wide$TotalCalories.2006)] <- 0

ESHA.Compare <- aggregate(formula=cbind(TotalCalories.1936, TotalCalories.2006) ~ Recipe,  data=ESHA.wide , FUN = sum )

lm(ESHA.Compare$TotalCalories.1936 ~ ESHA.Compare$TotalCalories.2006, data=ESHA.Compare)
summary(lm(ESHA.Compare$TotalCalories.1936 ~ ESHA.Compare$TotalCalories.2006, data=ESHA.Compare))

attach(ESHA.Compare)
# regression line (y~x)
plot(ESHA.Compare$TotalCalories.1936, ESHA.Compare$TotalCalories.2006, main="Scatterplot of ESHA TotalCalories by Year", xlab="Calories 1936 ",ylab="Calories 2006 ", pch=19)
abline(ESHA.Compare$TotalCalories.1936 ~ ESHA.Compare$TotalCalories.2006, col="blue")
# lowess line (x,y)
lines(lowess(ESHA.Compare$TotalCalories.1936, ESHA.Compare$TotalCalories.2006), col="blue") 

# QQ norm plot showing how calories spread for 1936 and 2006
library(lattice)
qqmath( ~ resid(lm(ESHA.Compare$TotalCalories.1936 ~ ESHA.Compare$TotalCalories.2006, data=ESHA.Compare, xlab="QQ-Norm", ylab="TotalCalories1936 ~ TotalCalories2006"))
)
```

#Analysis for ESHA linear regression

*As we can see the Coefficients intercept for Total Calories 2006 is 1.2419 with standard error of 0.1116. Interecept is where the expected mean value of calories 2006 when calories 1936 is zero.*

*If we look at the scatterplot in (ESHA total calories by year) we can see most of the calories from 1936 and 2006 are not far from each other for most of the recipes. This may or may not be true depending on the data due to the recipes coming from so many different sources.* 


*Linear Regression for 'basic.recipe.calc'*
```{r}
# creating 'basic' data in the wide form
# I was going to use it for linear regression but data do not look good for regression
# I was not able to aggregate it and collapse in one column without error so I used different route as below in next steps
basic.wide <- reshape(basic.recipe.calc[c("Recipe","Year","TotalCalories")],
idvar=c("Recipe","Year"),
direction="wide",
v.names="TotalCalories",
timevar="Year")

# Creating dataframes for 1936 and 2006
basic.1936 <- basic.recipe.calc[basic.recipe.calc$Year==1936,]
basic.2006 <- basic.recipe.calc[basic.recipe.calc$Year==2006,]

# replacing NA values with 0
basic.wide$TotalCalories.1936[is.na(basic.wide$TotalCalories.1936)] <- 0
basic.wide$TotalCalories.2006[is.na(basic.wide$TotalCalories.2006)] <- 0

# aggregateing using aggregate
basic.Compare <- aggregate(formula=cbind(TotalCalories.1936, TotalCalories.2006) ~ Recipe,  data=basic.wide , FUN = sum )

# Linear regression 
lm(basic.Compare$TotalCalories.1936 ~ basic.Compare$TotalCalories.2006, data=basic.Compare)
summary(lm(basic.Compare$TotalCalories.1936 ~ basic.Compare$TotalCalories.2006, data=basic.Compare))

attach(basic.Compare)
# regression line (y~x)
plot(basic.Compare$TotalCalories.1936, basic.Compare$TotalCalories.2006, main="Scatterplot of 4-4-9 TotalCalories by Year", xlab="Calories 1936 ",ylab="Calories 2006 ", pch=19)
abline(basic.Compare$TotalCalories.1936 ~ basic.Compare$TotalCalories.2006, col="red")
# lowess line (x,y)
lines(lowess(basic.Compare$TotalCalories.1936, basic.Compare$TotalCalories.2006), col="red") 

library(lattice)
qqmath( ~ resid(lm(basic.Compare$TotalCalories.1936 ~ basic.Compare$TotalCalories.2006, data= basic.Compare, xlab="QQ-Norm", ylab="TotalCalories1936 ~ TotalCalories2006"))
)
```

#Analysis for 4-4-9 linear regression

*As we can see the Coefficients intercept for Total Calories 2006 is 1.25 with standard error of 0.1105. Interecept is where the expected mean value of calories 2006 when calories 1936 is zero.*

*If we look at the scatterplot in (4-4-9 total calories by year) we can see most of the calories from 1936 and 2006 are not far from each other for most of the recipes. This may or may not be true depending on the data due to the recipes coming from so many different sources.* 


*Wansink Subset Comparison*
```{r}
library(dplyr)

# read in JoyOfCooking and drop rows that don't provide servings per recipe for 'TotalCalories' comparison
Wansink.dat <- read.csv("JoyOfCooking.csv")
Wansink.dat <- Wansink.dat[!(is.na(Wansink.dat$ServingsperRecipe1936)
                             & is.na(Wansink.dat$ServingsperRecipe2006)),]

# delete rows of table that weren't included in Wansink's study
Wansink.dat <- subset(Wansink.dat, Wansink.dat$TooMuch!=FALSE & Wansink.dat$Class=="Per-Serving")

# add columns to calculate total calories
Wansink.dat$TotalCalories1936 <- NA
Wansink.dat$TotalCalories2006 <- NA

# loop through table to calculate 'TotalCalories'
for (i in 1:nrow(Wansink.dat)) {
  Wansink.dat$TotalCalories1936[i] <- Wansink.dat$ServingsperRecipe1936[i] * Wansink.dat$CaloriesperServing1936[i]
  Wansink.dat$TotalCalories2006[i] <- Wansink.dat$ServingsperRecipe2006[i] * Wansink.dat$CaloriesperServing2006[i]
}

# temporarily splitting data set by year
Wansink.1936.dat <- Wansink.dat[,c("RecipeName", "TotalCalories1936")]
Wansink.2006.dat <- Wansink.dat[,c("RecipeName", "TotalCalories2006")]

# adding year column
Wansink.1936.dat$Year <- c(1936)
Wansink.2006.dat$Year <- c(2006)

# manipulating tables to replicate ESHA and 4-4-9 tables
Wansink.1936.dat <- Wansink.1936.dat[,c(1,3,2)]
Wansink.2006.dat <- Wansink.2006.dat[,c(1,3,2)]
colnames(Wansink.1936.dat)[which(colnames(Wansink.1936.dat)=="RecipeName")] <- "Recipe"
colnames(Wansink.1936.dat)[which(colnames(Wansink.1936.dat)=="TotalCalories1936")] <- "TotalCalories"
colnames(Wansink.2006.dat)[which(colnames(Wansink.2006.dat)=="RecipeName")] <- "Recipe"
colnames(Wansink.2006.dat)[which(colnames(Wansink.2006.dat)=="TotalCalories2006")] <- "TotalCalories"

# convert Recipe to character from factor for merge
Wansink.1936.dat$Recipe <- as.character(Wansink.1936.dat$Recipe)
Wansink.2006.dat$Recipe <- as.character(Wansink.2006.dat$Recipe)

# combining data tables to compare
Wansink.calc <- rbind(Wansink.1936.dat, Wansink.2006.dat, by = "Recipe")
Wansink.calc <- Wansink.calc[with(Wansink.calc, order(Wansink.calc$Recipe, Wansink.calc$Year)),]

# remove white space from Recipe to match ESHA and 4-4-9 tables
Wansink.calc$Recipe <- gsub("[^[:alpha:]]","",Wansink.calc$Recipe)

# using 'left_join' from the 'dplyr' library to combine 'Wansink.calc' with my ESHA and 4-4-9 tables by matching Recipe and Year values
ESHA.comp <- left_join(ESHA.recipe.calc, Wansink.calc, by=c("Recipe","Year"))
ESHA.comp <- ESHA.comp[!(is.na(ESHA.comp$TotalCalories.y)),]
basic.comp <- left_join(basic.recipe.calc, Wansink.calc, by=c("Recipe","Year"))
basic.comp <- basic.comp[!(is.na(basic.comp$TotalCalories.y)),]


# creating 3 tables with the 8 matching Recipe/Year values - TotalCalories_Wansink, TotalCalories_ESHA, and TotalCalories_449
Wansink.comp <- ESHA.comp[,c("Recipe", "Year", "TotalCalories.y"),]
colnames(Wansink.comp)[which(colnames(Wansink.comp)=="TotalCalories.y")] <- "TotalCalories_Wansink"
ESHA.comp <- ESHA.comp[,c("Recipe", "Year", "TotalCalories.x")]
colnames(ESHA.comp)[which(colnames(ESHA.comp)=="TotalCalories.x")] <- "TotalCalories_ESHA"
basic.comp <- basic.comp[,c("Recipe", "Year", "TotalCalories.x")]
colnames(basic.comp)[which(colnames(basic.comp)=="TotalCalories.x")] <- "TotalCalories_449"

# changing this column from character to numeric
Wansink.comp$TotalCalories_Wansink <- as.numeric(Wansink.comp$TotalCalories_Wansink)

Wansink.comp
ESHA.comp
basic.comp
```

*Creating scatterplots for comparisons between Wansink, 4-4-9, and ESHA*
```{r}
library(ggplot2)
library(gridExtra)

# scatterplots for each data set - removed axis x ticks because of amount of data
# color coded by year for easier comparison
ESHA.comp.plot <- 
  ggplot(ESHA.comp, aes(x=Recipe, y=TotalCalories_ESHA)) +
  geom_point(aes(colour = Year)) +
  coord_cartesian(ylim = c(0, 3500)) +
  ggtitle("ESHA Total Calories") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_hline(aes(yintercept = mean(TotalCalories_ESHA)))
Basic.comp.plot <- 
  ggplot(basic.comp, aes(x=Recipe, y=TotalCalories_449)) +
  geom_point(aes(colour = Year)) +
  coord_cartesian(ylim = c(0, 3500)) +
  ggtitle("4-4-9 Total Calories") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_hline(aes(yintercept = mean(TotalCalories_449)))
Wansink.comp.plot <-
  ggplot(Wansink.comp, aes(x=Recipe, y=TotalCalories_Wansink)) +
  geom_point(aes(colour = Year)) +
  coord_cartesian(ylim = c(0, 3500)) +
  ggtitle("Wansink Total Calories") +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_hline(aes(yintercept = mean(TotalCalories_Wansink)))

# from 'gridExtra' library - used ncol=1 to get wider plots to better visualize data
grid.arrange(ESHA.comp.plot, Basic.comp.plot, Wansink.comp.plot, ncol=1)

# boxplots to show distribution of Total Calories by year for each method
ESHA.comp.boxplot <- 
  ggplot(ESHA.comp, aes(x=Year, y=TotalCalories_ESHA)) +
  geom_boxplot(outlier.colour = "red",(aes(fill = Year))) +
  coord_cartesian(ylim = c(0, 3500)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank()) +
  ggtitle("ESHA Total Calories") +
  theme(plot.title = element_text(hjust = 0.5))
Basic.comp.boxplot <-
  ggplot(basic.comp, aes(x=Year, y=TotalCalories_449)) +
  geom_boxplot(outlier.colour = "red",(aes(fill = Year))) +
  coord_cartesian(ylim = c(0, 3500)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())+
  ggtitle("4-4-9 Total Calories") +
  theme(plot.title = element_text(hjust = 0.5))
Wansink.comp.boxplot <- 
  ggplot(Wansink.comp, aes(x=Year, y=TotalCalories_Wansink)) +
  geom_boxplot(outlier.colour = "red",(aes(fill = Year))) +
  coord_cartesian(ylim = c(0, 3500)) +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank())+
  ggtitle("Wansink Total Calories") +
  theme(plot.title = element_text(hjust = 0.5))

grid.arrange(ESHA.comp.boxplot, Basic.comp.boxplot, Wansink.comp.boxplot,ncol=1)
```

#Analysis for comparison of ESHA method vs. 4-4-9 Method

*The scatterplots, when comparing only the recipes used by Wansink that were also in our data, again show a strong correlation between ESHA and 4-4-9 methodology. Irish Stew from 1936 appears to have excluded a key ingredient or included an error in grams or calorie calculation. Wansink's calculation has the higher mean by a considerable amount. The higher mean can be partially, though not entirely, explained by the error in the Irish Stew recipe from ESHA and 4-4-9 plots. Among the remaining 3 recipes, Wansink is consistently higher for both years shown. In all 3 plots, there were 2 Total Calorie values from 2006 that were higher and 1 Total Calorie value from 1936 that was higher. The amount of these differences is interesting. In the ESHA and 4-4-9 plots, the differences are smaller with considerable overlap of the points. In the Wansink scatterplot, the difference is more pronounced.*

*Boxplots were also added to visualize the data, and outliers, by year. The boxplots show a wider distribution in Wansink's data than what was produced using ESHA and 4-4-9.*

*Since Wansink is calculating the highest Total Calories of the 3 models, my belief is that he used the 4-4-9 method since this method usually produces a slightly higher total. It also appears that he had different Ingredients or Amounts that what was found in the JoyOfCooking for these common recipes.*